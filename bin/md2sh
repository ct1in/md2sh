#!/bin/bash

if [[ 0 -eq $# ]]
then
	cat << EOF
USAGE: ${0##*/} [MD_FILEs]
EOF
	exit 0
fi

for foo
do
	[[ -s $foo ]] || continue

	code=$( awk '

/^[ \t]*``` shell[ \t]*$/ {
	match($0,/^[ \t]*/)
	indent = RLENGTH
	in_block = 1
	next
}

/^[ \t]*```[ \t]*$/ && in_block {
	in_block = 0
	next
}

in_block {
	print substr($0, indent + 1)
}
' "$foo")

eval "$code"

done

exit 0